{% extends layouts/Theaderaside.html %}
{{ 'Teacher Tasks' }}
{% block extra_head %}{% endblock %}
{% block_content %}
        <main>
            <div class="p-6">
                <div class="flex justify-between items-center  mb-6">
                    <div>
                        <h1 class="text-3xl font-bold ">Teacher Tasks</h1>
                    </div>
                    <div class="flex ">
                        <!-- Create Task Button -->
                        <button id="show-task-form"
                            class="bg-primary hover:bg-primary-dark text-white font-semibold px-6 py-2 rounded-lg ml-10  mt-6 mb-4">
                            + Create Task
                        </button>
                    </div>
                </div>

                <!-- Task Form Container -->
                <div id="task-form-container"
                    class="hidden bg-white rounded-xl shadow p-6  m  max-w-[400px] mx-auto  relative">

                    <!-- Close Button -->
                    <button id="close-task-form"
                        class="absolute top-2 right-2 text-gray-500 hover:text-red-600 text-xl font-bold">
                        Ã—
                    </button>

                    <!-- Task Creation Form -->
                    <form id="task-form">
                        <div class="mb-4">
                            <label for="delegate-address" class="block mb-1 font-medium">Delegate Address</label>
                            <input type="text" id="delegate-address" placeholder="Delegate username or ID" required
                                class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-400" />
                        </div>
                        <div class="mb-4">
                            <label for="task-title" class="block mb-1 font-medium">Task Title</label>
                            <input type="text" id="task-title" placeholder="Title of the task" required
                                class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-400" />
                        </div>
                        <div class="mb-4">
                            <label for="task-desc" class="block mb-1 font-medium">Task Description</label>
                            <textarea id="task-desc" rows="3" placeholder="Describe the task in detail" required
                                class="w-full border border-gray-300 rounded px-3 py-2 resize-none focus:outline-none focus:ring-2 focus:ring-green-400"></textarea>
                        </div>
                        <div class="mb-4">
                            <label for="task-deadline" class="block mb-1 font-medium">Deadline</label>
                            <input type="date" id="task-deadline" required
                                class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-400" />
                        </div>
                        <button type="submit"
                            class="bg-primary hover:bg-primary-dark text-white font-semibold px-6 py-2 rounded transition">
                            Create Task
                        </button>
                    </form>
                </div>


                <!-- Task list container -->
               <div id="task-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6 ml-9 mt-4" aria-live="polite"
                    aria-relevant="additions"></div>
        </main>
    {% endblock %}
    {% block js %}
    <script>
       
        // Toggle Task Form Visibility
        const showTaskFormBtn = document.getElementById("show-task-form");
        const taskFormContainer = document.getElementById("task-form-container");
        const closeTaskFormBtn = document.getElementById("close-task-form");

        showTaskFormBtn.addEventListener("click", () => {
            taskFormContainer.classList.remove("hidden");
        });

        closeTaskFormBtn.addEventListener("click", () => {
            taskFormContainer.classList.add("hidden");
        });


        // Status helper
        function getStatus(deadline) {
            const today = new Date();
            const dl = new Date(deadline);
            if (dl < today) return "overdue";
            return "pending";
        }

        // Render tasks
        function renderTeacherTasks() {
            taskGrid.innerHTML = "";
            const tasks = JSON.parse(localStorage.getItem("teacherTasks")) || [];
            tasks.forEach(task => {
                task.status = getStatus(task.deadline);

                let borderColor = "border-yellow-400";
                let statusBg = "bg-yellow-200";
                let statusText = "text-yellow-800";

                if (task.status === "completed") {
                    borderColor = "border-green-500";
                    statusBg = "bg-green-200";
                    statusText = "text-green-800";
                } else if (task.status === "overdue") {
                    borderColor = "border-red-500";
                    statusBg = "bg-red-200";
                    statusText = "text-red-800";
                }

                const card = document.createElement("div");
                card.className = `task-card hover:shadow-2xl animate-pop bg-white rounded-xl shadow p-5 border-l-4 ${borderColor}`;
                card.setAttribute("data-status", task.status);

                card.innerHTML = `
                <h3 class="text-lg font-bold mb-1">${task.title}</h3>
                <p class="mb-2 text-gray-700">${task.description}</p>
                <p class="mb-2"><strong>Delegate:</strong> ${task.delegate}</p>
                <p class="mb-2"><strong>Deadline:</strong> ${task.deadline}</p>
                <span class="inline-block px-3 py-1 rounded-full font-semibold ${statusBg} ${statusText} text-xs uppercase">${task.status}</span>
            `;

                taskGrid.appendChild(card);
            });

            localStorage.setItem("teacherTasks", JSON.stringify(tasks));
        }

        taskForm?.addEventListener("submit", e => {
            e.preventDefault();

            const delegate = document.getElementById("delegate-address").value.trim();
            const title = document.getElementById("task-title").value.trim();
            const description = document.getElementById("task-desc").value.trim();
            const deadline = document.getElementById("task-deadline").value;

            const newTask = {
                id: "task_" + Date.now(),
                delegate,
                title,
                description,
                deadline,
                status: getStatus(deadline)
            };

            const tasks = JSON.parse(localStorage.getItem("teacherTasks")) || [];
            tasks.push(newTask);
            localStorage.setItem("teacherTasks", JSON.stringify(tasks));

            taskForm.reset();
            renderTeacherTasks();
        });

        renderTeacherTasks();
    </script>
{% endblock %}

</body>

</html>