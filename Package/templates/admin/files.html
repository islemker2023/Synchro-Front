{% extends 'layouts/Aheaderaside.html' %}

{{ 'Files' }}

{% block extra_head %}{% endblock %}
{% block content %}
            <main>
                <div class="p-6">
                    <div class="flex justify-between items-center  mb-2">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-800 mb-2">Files</h1>
                            <p class="text-gray-600">access shared documents and resources</p>
                        </div>
                        <div class="flex bg-primary hover:bg-primary-dark rounded-xl border p-2">
                            <button id="openUploadModal" class="upload-btn"
                                class=" text-md text-white px-4 py-2 rounded-lg flex items-center">
                                <i class='bx bx-plus'></i>
                                <span>Upload</span>
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Modal Background -->
                <div id="uploadModal"
                    class="fixed mt-24 inset-0 mr-20 flex w-1/2 mx-auto  items-center justify-center hidden z-50">
                    <!-- Modal Content -->
                    <div class=" mx-auto mt-12 bg-white rounded-xl shadow-lg w-full max-w-md p-6 space-y-4">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-semibold text-gray-800">Upload File</h2>
                            <button id="closeModalBtn"
                                class="text-gray-500 hover:text-red-500 text-2xl">&times;</button>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">File Name</label>
                            <input type="text" id="fileNameInput"
                                class="w-full mt-1 px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"
                                placeholder="Enter file name">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">Receiver Email</label>
                            <input type="email" id="emailInput"
                                class="w-full mt-1 px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"
                                placeholder="Enter email address">
                        </div>

                        <div>
                            <label class="block  text-sm font-medium text-gray-700">Select File</label>
                            <input type="file" id="fileInput" class="w-full mt-1 ">
                        </div>

                        <div class="text-right">
                            <button id="uploadFileBtn"
                                class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-dark">
                                Upload
                            </button>
                        </div>
                    </div>
                </div>
                <div class="flex w-full px-4 gap-4">
                    <!-- LEFT CONTAINER: Main (2/3 width) -->
                    <div class="mb-4 w-1/3 bg-white rounded-2xl shadow-md p-4">
                        <h2 class=" text-lg font-semibold  border-b border-gray-300 pb-4 mb-2">Cours</h2>
                        <div class="  flex flex-grow flex-col  pt-2 ">
                           <button class="folder-toggle-btn flex items-center gap-3 truncate mb-4">
                                  <span class="chevron transition-transform duration-300">&gt;</span>
                                                   <i class="bx bx-folder text-yellow-400"></i>
                                               <p class="font-semibold text-gray-800 truncate">poo</p>
                           </button>
                            <button class="folder-toggle-btn flex items-center gap-3 truncate mb-4">
                                <span class="chevron transition-transform duration-300">&gt;</span>
                                <i class="bx bx-folder text-yellow-400"></i>
                                <p class="font-semibold text-gray-800 truncate">WCH</p>
                             </button>
                        <div onclick="addFolder(this)" data-parent-id="1" class="add-folder-btn"
                            class=" flex border-t border-gray-300  justify-center   ">
                            <button onclick="addFolder(this)" data-parent-id="1"
                                class="ml-9 bg-white hover:bg-gray-100 text-md text-gray-800 px-16 py-2 border-2 border-gray-500 mt-4 rounded-lg flex items-center">
                                <i class="bx bx-folder-plus mr-2"></i>
                                <span>Add Course</span>
                            </button>
                        </div>

                    </div>
                    </div>
                    <!-- RIGHT CONTAINER: Smaller (1/3 or less) -->
                    <div class="w-2/3  bg-white rounded-2xl shadow-md mb-4">
                        <div class="flex  justify-between items-start px-6 pt-6">
                            <div>
                                <h2 class="text-xl font-semibold text-gray-800 mb-1">Documents available</h2>
                                <p class="text-sm text-gray-500 mb-4">All shared documents</p>
                            </div>
                        </div>
                        <div class="overflow-x-auto px-6 pb-6">
                            <table class="w-full text-left border-separate border-spacing-y-2">
                                <thead>
                                    <tr class="text-gray-500 text-sm">
                                        <th class="pl-4 py-2">Name</th>
                                        <th class=" pr-4 py-2">Date</th>
                                        <th class="py-2">Shared by</th>
                                        <th class="py-2">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="folderTable" class="text-sm">
                                    <!-- Example Row -->
                                    <tr class="bg-gray-50 rounded-lg">
                                        <td class="px-4 py-3">
                                            <div class="flex items-center gap-3">
                                                <i class="bx bx-file text-red-500 text-xl"></i>
                                                <p class="font-medium text-gray-700">Cours_Algorithms_chap4.pdf</p>
                                            </div>
                                        </td>
                                        <td>
                                            <p class="font-medium">1 novomber 1954</p>
                                        </td>
                                        <td>
                                            <p class="font-medium">Sawssen</p>
                                        </td>
                                        <td>
                                            <button class="w-12 text-3xl">...</button>
                                        </td>
                                    <tr class="bg-gray-50 rounded-lg">
                                        <td class="px-4 py-3">
                                            <div class="flex items-center gap-3">
                                                <i class="bx bx-file text-primary text-xl"></i>
                                                <p class="font-medium text-gray-700">Cours_Reseau_chap2.pdf</p>
                                            </div>
                                        </td>
                                        <td>
                                            <p class="font-medium text-gray-700">5 July 1830</p>
                                        </td>
                                        <td>
                                            <p class="font-medium text-gray-700">Ahmed</p>
                                        </td>
                                        <td>
                                            <button class="w-12 text-3xl">...</button>
                                        </td>


                            </table>
                        </div>
                    </div>

                </div>

            </main>
        {% endblock %}
        {% block js %}
            let folderCounter = 2; // Start from 2 since we have folder with ID 1

            // Add folder functionality
            function addFolder() {
                const folderName = prompt("Enter folder name:");
                if (!folderName || folderName.trim() === "") return;

                const folderContainer = document.getElementById('folderContainer');
                const newFolderId = folderCounter++;

                // Create new folder element
                const newFolderDiv = document.createElement('div');
                newFolderDiv.className = 'folder-item mb-2';
                newFolderDiv.setAttribute('data-folder-id', newFolderId);
                newFolderDiv.setAttribute('data-level', '0');

                newFolderDiv.innerHTML = `
                <div class="flex items-center gap-3 cursor-pointer folder-header p-2 hover:bg-gray-50 rounded">
                    <span class="expand-icon transition-transform duration-200">></span>
                    <i class="bx bx-folder text-yellow-400"></i>
                    <p class="font-semibold text-gray-800 truncate">${folderName.trim()}</p>
                </div>
                <div class="folder-children ml-6 hidden"></div>
            `;

                folderContainer.appendChild(newFolderDiv);

                // Add event listener to the new folder
                setupFolderClickListener(newFolderDiv);
            }

            // Add child folder to a specific parent
            function addChildFolder(parentElement) {
                const folderName = prompt("Enter subfolder name:");
                if (!folderName || folderName.trim() === "") return;

                const parentLevel = parseInt(parentElement.dataset.level);
                const childLevel = parentLevel + 1;
                const newFolderId = folderCounter++;
                const childrenContainer = parentElement.querySelector('.folder-children');

                // Create child folder element
                const childFolderDiv = document.createElement('div');
                childFolderDiv.className = 'folder-item mb-1';
                childFolderDiv.setAttribute('data-folder-id', newFolderId);
                childFolderDiv.setAttribute('data-level', childLevel);

                childFolderDiv.innerHTML = `
                <div class="flex items-center gap-3 cursor-pointer folder-header p-2 hover:bg-gray-50 rounded">
                    <span class="expand-icon transition-transform duration-200">></span>
                    <i class="bx bx-folder text-yellow-400"></i>
                    <p class="font-semibold text-gray-800 truncate">${folderName.trim()}</p>
                </div>
                <div class="folder-children ml-6 hidden"></div>
            `;

                childrenContainer.appendChild(childFolderDiv);

                // Show the children container if it was hidden
                childrenContainer.classList.remove('hidden');

                // Update parent expand icon
                const parentExpandIcon = parentElement.querySelector('.expand-icon');
                parentExpandIcon.textContent = '⌄';

                // Add event listener to the new child folder
                setupFolderClickListener(childFolderDiv);
            }

            // Setup click listener for folders
            function setupFolderClickListener(folderElement) {
                const folderHeader = folderElement.querySelector('.folder-header');
                const childrenContainer = folderElement.querySelector('.folder-children');
                const expandIcon = folderElement.querySelector('.expand-icon');

                folderHeader.addEventListener('click', function (e) {
                    e.stopPropagation();

                    // Right-click or Ctrl+click to add child folder
                    if (e.ctrlKey || e.button === 2) {
                        e.preventDefault();
                        addChildFolder(folderElement);
                        return;
                    }

                    // Regular click to expand/collapse
                    const isHidden = childrenContainer.classList.contains('hidden');

                    if (isHidden) {
                        // Expand - show children
                        childrenContainer.classList.remove('hidden');
                        expandIcon.textContent = '⌄';
                        console.log('Expanded folder:', folderElement.querySelector('p').textContent);
                    } else {
                        // Collapse - hide children
                        childrenContainer.classList.add('hidden');
                        expandIcon.textContent = '>';
                        console.log('Collapsed folder:', folderElement.querySelector('p').textContent);
                    }
                });

                // Add right-click context menu
                folderHeader.addEventListener('contextmenu', function (e) {
                    e.preventDefault();
                    addChildFolder(folderElement);
                });
            }

            // Initialize existing folders and add some sample children to the first folder
            document.addEventListener('DOMContentLoaded', function () {
                const existingFolders = document.querySelectorAll('.folder-item');
                existingFolders.forEach(folder => {
                    setupFolderClickListener(folder);
                });

                // Add some sample child folders to the existing "Informatique-Blida1" folder for testing
                const firstFolder = document.querySelector('[data-folder-id="1"]');
                if (firstFolder) {
                    const childrenContainer = firstFolder.querySelector('.folder-children');

                    // Add sample children
                    const sampleChildren = [
                        { name: 'Algorithms', type: 'folder' },
                        { name: 'Database Systems', type: 'folder' },
                        { name: 'Networks', type: 'folder' },
                        { name: 'Course_Schedule.pdf', type: 'file' }
                    ];

                    sampleChildren.forEach((item, index) => {
                        const childElement = document.createElement('div');

                        if (item.type === 'folder') {
                            childElement.className = 'folder-item mb-1';
                            childElement.setAttribute('data-folder-id', `1-${index + 1}`);
                            childElement.setAttribute('data-level', '1');
                            childElement.innerHTML = `
                            <div class="flex items-center gap-3 cursor-pointer folder-header p-2 hover:bg-gray-50 rounded">
                                <span class="expand-icon transition-transform duration-200">></span>
                                <i class="bx bx-folder text-yellow-400"></i>
                                <p class="font-semibold text-gray-800 truncate">${item.name}</p>
                            </div>
                            <div class="folder-children ml-6 hidden"></div>
                        `;
                            setupFolderClickListener(childElement);
                        } else {
                            childElement.className = 'file-item mb-1';
                            childElement.innerHTML = `
                            <div class="flex items-center gap-3 p-2 hover:bg-gray-50 rounded ml-4">
                                <i class="bx bx-file text-red-500"></i>
                                <p class="text-gray-700 truncate">${item.name}</p>
                            </div>
                        `;
                        }

                        childrenContainer.appendChild(childElement);
                    });
                }
            });
            const modal = document.getElementById("uploadModal");
            const openBtn = document.getElementById("openUploadModal");
            const CloseBtn = document.getElementById("closeModalBtn");

            openBtn.onclick = () => modal.style.display = "block";
            closeBtn.onclick = () => modal.style.display = "none";
            window.onclick = (e) => {
                if (e.target === modal) modal.style.display = "none";
            };

            document.getElementById("uploadFileBtn").addEventListener("click", () => {
                const fileName = document.getElementById("fileNameInput").value;
                const email = document.getElementById("emailInput").value;
                const file = document.getElementById("fileInput").files[0];

                if (!fileName || !email || !file) {
                    alert("Please fill in all fields and select a file.");
                    return;
                }

                // 📤 You can replace this with actual file upload logic
                console.log("Uploading file:", fileName, email, file.name);
                alert("File uploaded successfully!");

                // Optionally reset form & close modal
                modal.style.display = "none";
            });
            document.querySelectorAll('.folder-toggle-btn').forEach(button => {
  button.addEventListener('click', () => {
    const chevron = button.querySelector('.chevron');
    chevron.classList.toggle('rotate-90');
  });
});

{% endblock %}

