{% extends 'layouts/Aheaderaside.html' %}

{{ 'Messages' }}

{% block extra_head %}{% endblock %}

{% block content %}
<main class="flex flex-grow  h-[calc(100vh-64px)] p-4 m-5">
            <div class="flex w-full bg-white rounded-lg shadow overflow-hidden">
                <!-- Left Section: Email Categories -->
                <div class="w-64 bg-white p-4 border-r">
                    <div class="flex items-center mb-6 text-green-700 font-semibold text-lg mt-1">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                            stroke="currentColor" class="size-6 mr-2">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M2.25 13.5h3.86a2.25 2.25 0 0 1 2.012 1.244l.256.512a2.25 2.25 0 0 0 2.013 1.244h3.218a2.25 2.25 0 0 0 2.013-1.244l.256-.512a2.25 2.25 0 0 1 2.013-1.244h3.859m-19.5.338V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338a2.25 2.25 0 0 0-2.15-1.588H6.911a2.25 2.25 0 0 0-2.15 1.588L2.35 13.177a2.25 2.25 0 0 0-.1.661Z" />
                        </svg>
                        Inbox
                    </div>
                    <hr class="mb-4">
                    <nav class="space-y-4 text-sm text-gray-700">
                        <button onclick="openCompose()">
                            <a href="#"
                                class="flex items-center space-x-2 late-y-1transition-transform duration-150 ease-in-out hover:translate-y-1 active:trans">
                                <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
                                </svg>
                                <span>Compose</span>
                            </a>
                        </button>
                        <a href="#"
                            class="flex items-center space-x-2 late-y-1transition-transform duration-150 ease-in-out hover:translate-y-1 active:trans">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-envelope" viewBox="0 0 16 16" stroke="currentColor" stroke-width="1">
                                <path
                                    d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1zm13 2.383-4.708 2.825L15 11.105zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741M1 11.105l4.708-2.897L1 5.383z" />
                            </svg>
                            <span>Primary</span>
                        </a>
                        <a href="#"
                            class="flex items-center space-x-2 late-y-1transition-transform duration-150 ease-in-out hover:translate-y-1 active:trans">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-archive" viewBox="0 0 16 16" stroke="currentColor" stroke-width="1">
                                <path
                                    d="M0 2a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1v7.5a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 1 12.5V5a1 1 0 0 1-1-1zm2 3v7.5A1.5 1.5 0 0 0 3.5 14h9a1.5 1.5 0 0 0 1.5-1.5V5zm13-3H1v2h14zM5 7.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5" />
                            </svg>
                            <span>archived</span>
                        </a>
                        <a href="#"
                            class="flex items-center space-x-2 late-y-1transition-transform duration-150 ease-in-out hover:translate-y-1 active:trans">
                            <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" fill="currentColor"
                                class="bi bi-list-stars" viewBox="0 0 16 16" stroke="currentColor" stroke-width="1">
                                <path fill-rule="evenodd"
                                    d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5" />
                                <path
                                    d="M2.242 2.194a.27.27 0 0 1 .516 0l.162.53c.035.115.14.194.258.194h.551c.259 0 .37.333.164.493l-.468.363a.28.28 0 0 0-.094.3l.173.569c.078.256-.213.462-.423.3l-.417-.324a.27.27 0 0 0-.328 0l-.417.323c-.21.163-.5-.043-.423-.299l.173-.57a.28.28 0 0 0-.094-.299l-.468-.363c-.206-.16-.095-.493.164-.493h.55a.27.27 0 0 0 .259-.194zm0 4a.27.27 0 0 1 .516 0l.162.53c.035.115.14.194.258.194h.551c.259 0 .37.333.164.493l-.468.363a.28.28 0 0 0-.094.3l.173.569c.078.255-.213.462-.423.3l-.417-.324a.27.27 0 0 0-.328 0l-.417.323c-.21.163-.5-.043-.423-.299l.173-.57a.28.28 0 0 0-.094-.299l-.468-.363c-.206-.16-.095-.493.164-.493h.55a.27.27 0 0 0 .259-.194zm0 4a.27.27 0 0 1 .516 0l.162.53c.035.115.14.194.258.194h.551c.259 0 .37.333.164.493l-.468.363a.28.28 0 0 0-.094.3l.173.569c.078.255-.213.462-.423.3l-.417-.324a.27.27 0 0 0-.328 0l-.417.323c-.21.163-.5-.043-.423-.299l.173-.57a.28.28 0 0 0-.094-.299l-.468-.363c-.206-.16-.095-.493.164-.493h.55a.27.27 0 0 0 .259-.194z" />
                            </svg>
                            <span>Starred</span>
                        </a>
                        <a href="#"
                            class="flex items-center space-x-2 late-y-1transition-transform duration-150 ease-in-out hover:translate-y-1 active:trans">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor"
                                viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
                                <path
                                    d="M 10 2 L 9 3 L 5 3 L 4 3 L 4 5 L 5 5 L 5 20 C 5 21.093063 5.9069372 22 7 22 L 17 22 C 18.093063 22 19 21.093063 19 20 L 19 5 L 20 5 L 20 3 L 19 3 L 18 3 L 15 3 L 14 2 L 10 2 z M 7 5 L 17 5 L 17 20 L 7 20 L 7 5 z">
                                </path>
                            </svg>
                            <span>Trash</span>
                        </a>
                        <!-- Compose Modal -->
                        <div id="composeModal"
                            class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
                            <div class="bg-white w-full max-w-md rounded-xl shadow-lg p-6">
                                <h2 class="text-xl font-semibold mb-4">New Email</h2>
                                <form method="POST" id="composeForm" class="space-y-3" action="{{ url_for('admin.messages.send_email', workspace_id=workspace.workspace_id) }}">
                                    <div>
                                        <label class="block text-sm font-medium">To:</label>
                                        <input type="email"
                                               name="email"
                                            class="w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 bg-gray-50"
                                            placeholder="recipient@example.com" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium">Subject:</label>
                                        <input type="text"
                                               name="Subject"
                                            class="w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 bg-gray-50"
                                            placeholder="Subject" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium">Message:</label>
                                        <textarea rows="5" name="Message"
                                            class="w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 bg-gray-100"
                                            placeholder="Type your message..." required></textarea>
                                    </div>
                                    <div class="flex justify-end gap-3">
                                        <button type="button" onclick="closeCompose()"
                                            class="bg-gray-200 text-black-300 px-4 py-2 rounded hover:bg-gray-300">Cancel</button>
                                        <button type="submit"
                                                name="submit"
                                            class="bg-primary text-white px-4 py-2 rounded hover:bg-primary-dark">Send</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </nav>
                </div>

                <!-- Divider -->
                <div class="w-px bg-gray-200"></div>

                <!-- Right Section: Inbox -->
                <div class="flex-1 p-6 overflow-y-auto bg-gray-50 flex flex-col">

                    <!-- Search bar -->
                    <div class="relative mb-4">
                        <input id="searchInput" type="text" placeholder="Search emails..."
                            class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 outline-none shadow-sm">
                        <svg class="w-5 h-5 text-gray-400 absolute left-3 top-2.5" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M21 21l-4.35-4.35M11 19a8 8 0 100-16 8 8 0 000 16z" />
                        </svg>
                    </div>

                    <!-- Emails container with margin to separate from background -->
                   <div id="emailsContainer"
    class="bg-white rounded-lg shadow divide-y divide-gray-200 flex-grow overflow-y-auto">

    {% for message_content, subject, email in messages %}
    <div class="flex items-start space-x-4 p-4 hover:bg-gray-50 cursor-pointer group">
        <!-- Star icon -->
        <svg class="star-icon h-5 w-5 text-yellow-400 mt-4 cursor-pointer transition-colors"
            fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24
                    l-7.19-.61L12 2 9.19 8.63 2 9.24
                    l5.46 4.73L5.82 21z" />
        </svg>

        <!-- Initials -->
        <div
            class="w-10 h-10 bg-blue-500 text-white rounded-full flex items-center justify-center font-semibold text-sm uppercase mt-2">
        </div>

        <!-- Email content -->
        <div class="flex-1">
            <div class="email-address text-lg font-semibold text-gray-800">{{ email }}</div>
            <div class="email-subject text-sm text-gray-600 font-medium">{{ subject }}</div>
            <div class="email-snippet text-sm text-gray-500 truncate">{{ message_content[:25] }}{% if message_content|length > 25 %}...{% endif %}</div>
        </div>
         <!-- Archive icon (clickable, shows on hover) -->
               <div class="relative group">
                     <div class="p-1 rounded-full transition-all duration-300 hover:bg-yellow-100 mt-3.5">
                           <svg
                            class="archive-icon h-5 w-5 text-yellow-500 opacity-0 group-hover:opacity-100 cursor-pointer transition-opacity"
                             fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round"
                             d="M20 7V6a2 2 0 00-2-2H6a2 2 0 00-2 2v1m16 0v11a2 2 0 01-2 2H6a2 2 0 01-2-2V7m16 0H4m6 4h4" />
                           </svg>
                       </div>
                 </div>

        <!-- Trash icon -->
        <div class="relative group">
            <div class="p-1 rounded-full transition-all duration-300 hover:bg-red-100 mt-3.5">
                <svg class="trash-icon h-5 w-5 text-red-500 opacity-0 group-hover:opacity-100 cursor-pointer transition-opacity"
                    fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M6 18L18 6M6 6l12 12" />
                </svg>
            </div>
        </div>
    </div>
    {% endfor %}

    <!-- No emails message -->
    {% if messages|length == 0 %}
    <div id="noEmailsMessage" class="p-6 text-center text-gray-500">
        No emails found.
    </div>
    {% endif %}
</div>

                </div>
            </div>
        </main>
 {% endblock %}

{% block js %}
    // Modal functions only
    function openCompose() {
        document.getElementById('composeModal').classList.remove('hidden');
        document.getElementById('composeModal').classList.add('flex');
        clearForm();
    }

    function closeCompose() {
        document.getElementById('composeModal').classList.add('hidden');
        document.getElementById('composeModal').classList.remove('flex');
        clearForm();
    }

    function clearForm() {
        document.getElementById('composeForm').reset();
    }

    // Close modal when clicking outside
    document.getElementById('composeModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeCompose();
        }
    });
 {% endblock %}
