{% extends 'layouts/Theaderaside.html' %}

{{ 'Teacher Tasks' }}

{% block extra_head %}{% endblock %}

{% block content %}

        <main class="w-full max-w-4xl">
            <h1 class="text-3xl font-bold mt-6 mb-5 ml-5">Teacher Tasks</h1>

            <!-- Task creation form -->
            <form id="task-form" class="bg-white rounded-xl shadow p-6 ml-10 w-full">
                <div class="mb-4">
                    <label for="delegate-address" class="block mb-1 font-medium">Delegate Address</label>
                    <input type="text" id="delegate-address" placeholder="Delegate username or ID" required
                        class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-400 bg-gray-50" />
                </div>
                <div class="mb-4">
                    <label for="task-title" class="block mb-1 font-medium">Task Title</label>
                    <input type="text" id="task-title" placeholder="Title of the task" required
                        class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-400 bg-gray-50" />
                </div>
                <div class="mb-4">
                    <label for="task-desc" class="block mb-1 font-medium">Task Description</label>
                    <textarea id="task-desc" rows="3" placeholder="Describe the task in detail" required
                        class="w-full border border-gray-300 rounded px-3 py-2 resize-none focus:outline-none focus:ring-2 focus:ring-green-400 bg-gray-50"></textarea>
                </div>
                <div class="mb-4">
                    <label for="task-deadline" class="block mb-1 font-medium">Deadline</label>
                    <input type="date" id="task-deadline" required
                        class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-400 bg-gray-50" />
                </div>
                <button type="submit"
                    class="bg-green-500 hover:bg-green-600 text-white font-semibold px-6 py-2 rounded transition">
                    Create Task
                </button>
            </form>
          <!-- Filter Buttons -->
            <div class="mb-6 flex flex-wrap gap-3 mt-5 ml-6">
                <button data-filter="all"
                    class="filter-btn bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-1 px-4 rounded-full transition">All</button>
                <button data-filter="pending"
                    class="filter-btn bg-yellow-100 hover:bg-yellow-200 text-yellow-800 font-medium py-1 px-4 rounded-full transition">Pending</button>
                <button data-filter="completed"
                    class="filter-btn bg-green-100 hover:bg-green-200 text-green-800 font-medium py-1 px-4 rounded-full transition">Completed</button>
                <button data-filter="overdue"
                    class="filter-btn bg-red-100 hover:bg-red-200 text-red-800 font-medium py-1 px-4 rounded-full transition">Overdue</button>
            </div>


            <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3 mb-20 ml-4">
                <!-- Task Card -->
                <div class="task-card animate-pop bg-white rounded-xl shadow p-5 border-l-4 border-yellow-400"
                    data-status="pending">
                    <h2 class="text-lg font-semibold text-gray-800">Upload Class Notes</h2>
                    <p class="text-sm text-gray-600 mt-2">Upload all the notes from this weekâ€™s math lecture to the
                        platform.</p>
                    <div class="flex justify-between items-center mt-4">
                        <span class="text-sm text-gray-500">Deadline: <strong>May 28</strong></span>
                        <span
                            class="text-xs bg-yellow-200 text-yellow-800 px-2 py-1 rounded-full font-medium">Pending</span>
                    </div>
                </div>

                <!-- Completed Task -->
                <div class="task-card animate-pop bg-white rounded-xl shadow p-5 border-l-4 border-green-400"
                    data-status="completed">
                    <h2 class="text-lg font-semibold text-gray-800">Submit Attendance List</h2>
                    <p class="text-sm text-gray-600 mt-2">The list was submitted to the teacher last Friday.</p>
                    <div class="flex justify-between items-center mt-4">
                        <span class="text-sm text-gray-500">Deadline: <strong>May 20</strong></span>
                        <span
                            class="text-xs bg-green-200 text-green-800 px-2 py-1 rounded-full font-medium">Completed</span>
                    </div>
                </div>

                <!-- Overdue Task -->
                <div class="task-card animate-pop bg-white rounded-xl shadow p-5 border-l-4 border-red-400"
                    data-status="overdue">
                    <h2 class="text-lg font-semibold text-gray-800">Create Exam Revision Guide</h2>
                    <p class="text-sm text-gray-600 mt-2">Organize key points and examples for the upcoming exam.</p>
                    <div class="flex justify-between items-center mt-4">
                        <span class="text-sm text-gray-500">Deadline: <strong>May 21</strong></span>
                        <span class="text-xs bg-red-200 text-red-800 px-2 py-1 rounded-full font-medium">Overdue</span>
                    </div>
                </div>
                <div class="task-card animate-pop bg-white rounded-xl shadow p-5 border-l-4 border-red-400"
                    data-status="overdue">
                    <h2 class="text-lg font-semibold text-gray-800">Create Exam Revision Guide</h2>
                    <p class="text-sm text-gray-600 mt-2">Organize key points and examples for the upcoming exam.</p>
                    <div class="flex justify-between items-center mt-4">
                        <span class="text-sm text-gray-500">Deadline: <strong>May 21</strong></span>
                        <span class="text-xs bg-red-200 text-red-800 px-2 py-1 rounded-full font-medium">Overdue</span>
                    </div>
                </div>
                <div class="task-card animate-pop bg-white rounded-xl shadow p-5 border-l-4 border-red-400"
                    data-status="overdue">
                    <h2 class="text-lg font-semibold text-gray-800">Create Exam Revision Guide</h2>
                    <p class="text-sm text-gray-600 mt-2">Organize key points and examples for the upcoming exam.</p>
                    <div class="flex justify-between items-center mt-4">
                        <span class="text-sm text-gray-500">Deadline: <strong>May 21</strong></span>
                        <span class="text-xs bg-red-200 text-red-800 px-2 py-1 rounded-full font-medium">Overdue</span>
                    </div>
                </div>
            </div>

{% endblock %}
{% block js %}
        const taskForm = document.getElementById("task-form");
        const taskGrid = document.getElementById("task-grid");

        // Helper: determine status based on deadline and today
        function getStatus(deadline) {
            const today = new Date();
            const dl = new Date(deadline);
            if (dl < today) return "overdue";
            return "pending";
        }

        // Render tasks stored in localStorage
        function renderTeacherTasks() {
            taskGrid.innerHTML = "";
            const tasks = JSON.parse(localStorage.getItem("teacherTasks")) || [];
            tasks.forEach(task => {
                // Update status dynamically in case deadline passed
                task.status = getStatus(task.deadline);

                let borderColor = "border-yellow-400";
                let statusBg = "bg-yellow-200";
                let statusText = "text-yellow-800";

                if (task.status === "completed") {
                    borderColor = "border-green-500";
                    statusBg = "bg-green-200";
                    statusText = "text-green-800";
                } else if (task.status === "overdue") {
                    borderColor = "border-red-500";
                    statusBg = "bg-red-200";
                    statusText = "text-red-800";
                }

                const card = document.createElement("div");
                card.className = `task-card animate-pop bg-white rounded-xl shadow p-5 border-l-4 ${borderColor}`;
                card.setAttribute("data-status", task.status);

                card.innerHTML = `
      <h3 class="text-lg font-bold mb-1">${task.title}</h3>
      <p class="mb-2 text-gray-700">${task.description}</p>
      <p class="mb-2"><strong>Delegate:</strong> ${task.delegate}</p>
      <p class="mb-2"><strong>Deadline:</strong> ${task.deadline}</p>
      <span class="inline-block px-3 py-1 rounded-full font-semibold ${statusBg} ${statusText} text-xs uppercase">${task.status}</span>
    `;

                taskGrid.appendChild(card);
            });

            // Save updated statuses back to localStorage
            localStorage.setItem("teacherTasks", JSON.stringify(tasks));
        }

        taskForm.addEventListener("submit", e => {
            e.preventDefault();

            const delegate = document.getElementById("delegate-address").value.trim();
            const title = document.getElementById("task-title").value.trim();
            const description = document.getElementById("task-desc").value.trim();
            const deadline = document.getElementById("task-deadline").value;

            const newTask = {
                id: "task_" + Date.now(),
                delegate,
                title,
                description,
                deadline,
                status: getStatus(deadline)
            };

            const tasks = JSON.parse(localStorage.getItem("teacherTasks")) || [];
            tasks.push(newTask);
            localStorage.setItem("teacherTasks", JSON.stringify(tasks));

            taskForm.reset();
            renderTeacherTasks();
        });

        // Initial render
        renderTeacherTasks();
{% endblock %}